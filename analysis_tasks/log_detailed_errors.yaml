id: log_detailed_errors
name: Detailed Log Error Analysis
description: Detect high error rates in Kafka logs indicating system instability
category: cluster_hygiene

prompt: |
  Analyze Kafka logs for error patterns and high error rates.
  
  Log Data:
  {logs}
  
  Comprehensive Error Analysis:
  1. Count and categorize all ERROR and FATAL level messages
  2. Identify the top error patterns:
     - Group similar errors together
     - Count occurrences of each pattern
     - Note the time distribution (spike vs continuous)
  3. Categorize errors by type:
     - Connection/Network errors
     - Disk I/O errors
     - Memory/GC errors
     - Replication errors
     - Client errors
     - Security/Auth errors
     - Configuration errors
  4. Determine error rate:
     - Errors per minute/hour
     - Is it increasing, stable, or decreasing?
     - Are there specific time patterns?
  5. Impact assessment:
     - Which components are affected?
     - Is it affecting production/consumption?
     - Is it affecting specific topics/partitions?
  6. Root cause for each error pattern
  
  Common critical patterns to look for:
  - OutOfMemoryError
  - Too many open files
  - No space left on device
  - Connection refused
  - Authentication failed
  - Corrupt index/log
  - IOException
  - IllegalStateException
  
  For each error pattern provide:
  - Sample error message
  - Frequency/count
  - First and last occurrence
  - Affected components
  - Severity assessment
  
  Format as JSON:
  {
    "findings": [{
      "title": "High error rate detected",
      "severity": "high",
      "description": "X errors/minute detected",
      "error_summary": {
        "total_errors": 1000,
        "error_rate": "50/min",
        "time_range": "last hour"
      },
      "top_errors": [
        {
          "pattern": "Connection refused",
          "count": 500,
          "sample": "Full error message...",
          "impact": "Broker communication failures"
        }
      ],
      "root_cause": "Analysis of why errors are occurring",
      "remediation": "Steps to fix each error type"
    }]
  }

severity_keywords:
  "fatal": "critical"
  "OutOfMemory": "critical"
  "no space left": "critical"
  "too many open files": "critical"
  "high error rate": "high"
  "corrupt": "high"
  "IOException": "medium"
  "error": "medium"
  "warning": "low"

default_severity: high
enabled: true
