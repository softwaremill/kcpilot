id: leader_imbalance
name: Leader Distribution Imbalance
description: Detect uneven leader distribution causing load imbalance
category: performance

prompt: |
  Analyze the leader distribution across Kafka brokers for load balancing issues.
  
  Admin/Topic Data:
  {admin}
  
  Broker Metrics (if available):
  {metrics}
  
  Analysis required:
  1. Count the number of partition leaders per broker
  2. Calculate the average leaders per broker
  3. Identify imbalance:
     - Which brokers have significantly more leaders (>20% above average)?
     - Which brokers have significantly fewer leaders (<20% below average)?
  4. Calculate the impact:
     - Uneven CPU/memory usage
     - Network bandwidth concentration
     - Client connection imbalance
  5. Determine why imbalance exists:
     - Preferred leader election not running
     - Manual reassignments
     - Broker failures and recoveries
     - auto.leader.rebalance.enable=false
  
  Provide specific numbers:
  - Max leaders on a single broker: X
  - Min leaders on a single broker: Y
  - Average leaders per broker: Z
  - Standard deviation: S
  
  Recommendations should include:
  - Whether to run preferred leader election
  - Configuration changes needed
  - Manual rebalancing if required
  
  Format as JSON:
  {
    "findings": [{
      "title": "Leader distribution imbalance detected",
      "severity": "medium",
      "description": "Broker X has Y% more leaders than average",
      "impact": "Performance bottleneck on overloaded brokers",
      "leader_distribution": {
        "broker_1": 150,
        "broker_2": 50,
        "broker_3": 100
      },
      "statistics": {
        "average": 100,
        "max": 150,
        "min": 50,
        "imbalance_percentage": 50
      },
      "remediation": "Run preferred leader election"
    }]
  }

severity_keywords:
  "severe imbalance": "high"
  "significant imbalance": "medium"
  "imbalanced": "medium"
  "bottleneck": "high"
  "overloaded": "high"
  "slight imbalance": "low"

default_severity: medium
enabled: true
