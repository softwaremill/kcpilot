id: root_cause_analysis
name: Intelligent Root Cause Analysis
description: Perform deep root cause analysis by correlating all available data
category: cluster_hygiene

prompt: |
  Perform comprehensive ROOT CAUSE ANALYSIS of issues in this Kafka cluster.
  
  All Available Data:
  Admin/Topics: {admin}
  Logs: {logs}
  Configuration: {config}
  Metrics: {metrics}
  
  Your task is to:
  1. Identify ALL symptoms/issues present in the cluster:
     - Errors in logs
     - Performance degradation
     - Availability issues
     - Configuration problems
  
  2. Correlate symptoms to find root causes:
     - Look for temporal correlation (what happened first?)
     - Look for spatial correlation (same broker/topic/partition?)
     - Look for causal relationships
     - Consider cascade failures
  
  3. Build a causality chain:
     - Root cause → Intermediate effects → Observable symptoms
     - Example: Disk full → Broker crash → Under-replicated partitions
  
  4. Identify contributing factors:
     - Configuration that made the problem worse
     - Missing monitoring/alerting
     - Lack of resource headroom
  
  5. Provide confidence levels:
     - How certain are you about each root cause? (0-100%)
     - What additional data would increase confidence?
  
  6. Suggest verification steps:
     - How to confirm the root cause hypothesis
     - What metrics/logs to check
  
  Common root cause patterns:
  - Resource exhaustion (disk, memory, CPU, network)
  - Configuration mistakes
  - Hardware failures
  - Network issues
  - Client misbehavior
  - Version incompatibilities
  - Cascade failures from single point of failure
  
  Format as JSON:
  {
    "findings": [{
      "title": "Root cause identified: [specific cause]",
      "severity": "high",
      "description": "Detailed root cause analysis",
      "symptoms_observed": [
        "Under-replicated partitions",
        "High error rate in logs",
        "Performance degradation"
      ],
      "root_cause": "Disk space exhaustion on broker 2",
      "causality_chain": [
        "High retention settings",
        "Disk filled to 100%",
        "Broker stopped accepting writes",
        "Replicas fell behind",
        "ISR shrinkage occurred"
      ],
      "confidence": 85,
      "contributing_factors": [
        "No disk space monitoring",
        "Retention too high for disk size"
      ],
      "verification_steps": [
        "Check df -h on broker 2",
        "Review disk metrics history"
      ],
      "remediation": "1. Free disk space\n2. Adjust retention\n3. Add monitoring"
    }]
  }

severity_keywords:
  "root cause": "high"
  "cascade failure": "critical"
  "systemic issue": "high"
  "underlying problem": "high"

default_severity: high
enabled: true
