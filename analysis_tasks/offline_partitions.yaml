id: offline_partitions
name: Offline Partitions Detection
description: Detect partitions without leaders that are completely unavailable
category: availability

prompt: |
  Analyze the Kafka cluster for OFFLINE partitions (partitions with no leader).
  
  Admin/Topic Data:
  {admin}
  
  Broker Status and Logs:
  {logs}
  
  CRITICAL: Look for partitions where leader is -1, null, or missing.
  
  Please identify:
  1. ALL offline partitions (those without any leader)
  2. The topics affected and business impact
  3. Root cause analysis:
     - All replicas for the partition are down
     - Broker failures (which broker IDs?)
     - Unclean leader election disabled preventing recovery
     - Corrupted log segments
     - ZooKeeper/KRaft metadata issues
  4. Duration of the outage (if determinable from logs)
  5. Recovery steps in order of safety:
     - Safe recovery options first
     - Risky options (like unclean leader election) last
  
  Search logs for:
  - "No leader found"
  - "All replicas are offline"
  - "Failed to elect leader"
  - "Offline partition"
  - "Leadership election failed"
  
  This is a CRITICAL issue - partitions are completely unavailable!
  
  Format as JSON:
  {
    "findings": [{
      "title": "Offline partitions detected - CRITICAL",
      "severity": "critical",
      "description": "X partitions are offline and unavailable",
      "impact": "Complete outage for affected topics",
      "root_cause": "Why partitions are offline",
      "offline_partitions": [
        {"topic": "name", "partition": 0, "replicas": [1,2,3]}
      ],
      "remediation": "Emergency recovery steps"
    }]
  }

severity_keywords:
  "offline": "critical"
  "no leader": "critical"
  "all replicas down": "critical"
  "completely unavailable": "critical"
  "election failed": "critical"

default_severity: critical
enabled: true
